import base64import osimport requestsfrom application import celery, loggerfrom application.rests.mongo import update_onefrom application.utils.helpers import (extract_file_name_from_url, get_config,                                       get_content_of_pdf)@celery.task(bind=True, name="download_pdf")def task_download_pdf(self, pub_id: str, url: str):    resd = {"status": "ok"}    files_path = get_config("FILES_PATH")    file_name = extract_file_name_from_url(url)    if not os.path.exists(files_path):        os.makedirs(files_path)    try:        pdf_raw = requests.get(url).content        full_path = f'{files_path}/{file_name}.pdf'        with open(full_path, "wb+") as f:            f.write(pdf_raw)        resd["path"] = full_path        content = get_content_of_pdf(full_path)        result = update_one(            "publication",            {                "filter": {                    "id_citations": {"$eq": pub_id}                },                "update": {                    "$set": {                        "raw_base64": base64.encodebytes(pdf_raw).decode(                            "utf-8"),                        "content": content                    }                },                "upsert": True            }        )        if result is not None:            logger.info(f'Content is added to publication.')    except Exception as e:        logger.exception(e)        resd["status"] = "failure"        resd["failure_detail"] = str(e)    return resd